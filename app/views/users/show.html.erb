<% provide(:title, @user.first_name) %>
<% if user_logged_in? && !current_user.manager? %>
  <%= render 'layouts/interpreter_dashboard' %>
<% elsif user_logged_in? && current_user.manager? %>
  <%= render 'layouts/manager_dashboard' %>
<% end %>
<div id="page-wrapper">
	<%= render 'layouts/alerts' %>
	<div class="row">
  	<aside class="col-lg-12">
    	<section class="user_info">
    		<div class="page-header">
  				<h3>
  					<%= @user.first_name %> <%= @user.last_name %>
  					<small>
              <% if !@user.approved? %>
                Pending Interpreter
  						<% elsif @user.admin? %>
      					Administrator
      				<% elsif @user.manager? %>
      					Manager
      				<% else %>
      					Interpreter
      				<% end %>
  					</small>
  				</h3>
				</div>
        <!-- /.page-header -->
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>
                ID
              </th>
              <th>
                Name
              </th>
              <th>
                Role
              </th>
              <th>
                Gender
              </th>
              <th>
                Email
              </th>
              <th>
                Cell Phone Number
              </th>
              <th>
                Joined
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <%= @user.id %>
              </td>
              <td>
                <%= @user.first_name %> <%= @user.last_name %>
              </td>
              <td>
                <% if !@user.approved? %>
                  Pending Interpreter
                <% elsif @user.admin? %>
                  Administrator
                <% elsif @user.manager? %>
                  Manager
                <% else %>
                  Interpreter
                <% end %>
              </td>
              <td>
                <%= @user.gender %>
              </td>
              <td>
                <%= @user.email %>
              </td>
              <td>
                <%= @user.cell_phone %>
              </td>
              <td>
                <%= @user.created_at.strftime("%b %d, %Y") %>
              </td>
            </tr>
          </tbody>
        </table>
        <!-- /.table table-striped table-hover -->
        <% if current_user?(@user) %>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">
            Show Qualifications
          </button>
          <!-- /.btn btn-primary -->
        <% end %>
      	<% if @user.approved? && current_user.admin? && !current_user?(@user) %>
      		<h4>
      			Admin Options:
      		</h4>
      		<div class="btn-group" role="group" aria-label="Justified button group">
      			<% if @user.admin? %>
      				<%= link_to "Demote to Manager", demote_to_manager_user_path(id: @user.id), class: "btn btn-primary", role:"button", :data => {:confirm => "Are you sure you want to demote #{@user.first_name} #{@user.last_name} to manager?"} %>
      			<% elsif @user.manager? %>
      				<%= link_to "Promote to Admin", promote_to_admin_user_path(id: @user.id), class: "btn btn-primary", role:"button", :data => {:confirm => "Are you sure you want to promote #{@user.first_name} #{@user.last_name} to admin?"} %>
      				<%= link_to "Demote to Interpreter", demote_to_interpreter_user_path(id: @user.id), class: "btn btn-primary", role:"button", :data => {:confirm => "Are you sure you want to demote #{@user.first_name} #{@user.last_name} to interpreter?"} %>
      			<% elsif !@user.admin? %>
      				<%= link_to "Promote to Manager", promote_to_manager_user_path(id: @user.id), class: "btn btn-primary", role:"button", :data => {:confirm => "Are you sure you want to promote #{@user.first_name} #{@user.last_name} to manager?"} %>
      			<% end %>
            <% if @user.active? %>
      			 <%= link_to "Deactivate Account", deactivate_user_user_path(id: @user.id), class: "btn btn-danger", role:"button", :data => {:confirm => "Are you sure you want to deactivate #{@user.first_name} #{@user.last_name}'s account? They will no longer be able to use the site."} %>
            <% else %>
              <%= link_to "Reactivate Account", reactivate_user_user_path(id: @user.id), class: "btn btn-success", role:"button", :data => {:confirm => "Are you sure you want to reactivate #{@user.first_name} #{@user.last_name}'s account? They will be able to use the site again."} %>
            <% end%>
      		</div>
      		<!-- /.btn-group btn-group-justified -->
        <% elsif !@user.approved? && current_user.manager? && !current_user?(@user) %>
          <h4>
            Manager Options:
          </h4>
          <div class="btn-group" role="group" aria-label="Justified button group">
            <%= link_to "Approve Account Request", approve_account_user_path(id: @user.id), class: "btn btn-success", role:"button", :data => {:confirm => "Are you sure you want to approve #{@user.first_name} #{@user.last_name}'s account request? They will be notified via email."} %>
            <%= link_to "Deny Account Request", @user, method: :delete, class: "btn btn-danger", role:"button", :data => {:confirm => "Are you sure you want to permanently deny #{@user.first_name} #{@user.last_name}'s account request? (Warning: This cannot be reversed.)"} %>
          </div>
          <!-- /.btn-group btn-group-justified -->
      	<% end %>
        <%= render 'users/qualification_modal' %>
        <% if @user.approved? && current_user.manager? && !current_user?(@user) %>
          <h4>
            Manager Options:
          </h4>
          <%= render 'users/edit_qualifications' %>
        <% end %>
        <% if @user.approved? && current_user.manager? && !current_user?(@user) %>
          <h3 class="page-header">
            Current Jobs
          </h3>
          <!-- /.page-header -->
          <% if @current_jobs.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    ID
                  </th>
                  <th>
                   Customer Name
                  </th>
                  <th>
                    Location
                  </th>
                  <th>
                    Start
                  </th>
                  <th>
                    End
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @current_jobs.each do |current_job| %>
                  <tr>
                    <td>
                      <%= link_to "#{current_job.id}", current_job %>
                    </td>
                    <td>
                      <%= link_to "#{current_job.customer.customer_name}", current_job %>
                    </td>
                    <td>
                      <%= current_job.city %>, <%= current_job.state %> <%= current_job.zip %>
                    </td>
                    <td>
                      <%= current_job.start.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <%= current_job.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
          <% end %>
          <h3 class="page-header">
            Pending Jobs
          </h3>
          <!-- /.page-header -->
          <% if @pending_jobs.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    ID
                  </th>
                  <th>
                   Customer Name
                  </th>
                  <th>
                    Location
                  </th>
                  <th>
                    Start
                  </th>
                  <th>
                    End
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @pending_jobs.each do |pending_job| %>
                  <tr>
                    <td>
                      <%= link_to "#{pending_job.id}", pending_job %>
                    </td>
                    <td>
                      <%= link_to "#{pending_job.customer.customer_name}", pending_job %>
                    </td>
                    <td>
                      <%= link_to "#{pending_job.city}, #{pending_job.state} #{pending_job.zip}", pending_job %>
                    </td>
                    <td>
                      <%= pending_job.start.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <%= pending_job.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
          <% end %>
          <h3 class="page-header">
            Completed Jobs
          </h3>
          <!-- /.page-header -->
          <% if @completed_jobs.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    ID
                  </th>
                  <th>
                   Customer Name
                  </th>
                  <th>
                    Location
                  </th>
                  <th>
                    Start
                  </th>
                  <th>
                    End
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @completed_jobs.each do |completed_job| %>
                  <tr>
                    <td>
                      <%= link_to "#{completed_job.id}", completed_job %>
                    </td>
                    <td>
                      <%= link_to "#{completed_job.customer.customer_name}", completed_job %>
                    </td>
                    <td>
                      <%= completed_job.city %>, <%= completed_job.state %> <%= completed_job.zip %>
                    </td>
                    <td>
                      <%= completed_job.start.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <%= completed_job.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
          <% end %>
          <h3 class="page-header">
            Rejected Jobs
          </h3>
          <!-- /.page-header -->
          <% if @rejected_jobs.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    Location
                  </th>
                  <th>
                    Start
                  </th>
                  <th>
                    End
                  </th>
                  <th>
                    Action
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @rejected_jobs.each do |rejected_job| %>
                  <tr>
                    <td>
                      <%= rejected_job.city %>, <%= rejected_job.state %>
                    </td>
                    <td>
                      <%= rejected_job.start.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <%= rejected_job.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      TBD
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
          <% end %>
          <h3 class="page-header">
            Submitted Interpreter Invoices
          </h3>
          <!-- /.page-header -->
          <% if @interpreter_invoices.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    ID
                  </th>
                  <th>
                    Job
                  </th>
                  <th>
                    Start
                  </th>
                  <th>
                    End
                  </th>
                  <th>
                    <% if current_user.manager? %>
                      Manager Invoice?
                    <% else %>
                      TSHA Invoice?
                    <% end %>
                  </th>
                </tr>
              </thead>
              <tbody>
                <% @interpreter_invoices.each do |interpreter_invoice| %>
                  <tr>
                    <td>
                      <%= link_to "Invoice ##{interpreter_invoice.id}", interpreter_invoice %>
                    </td>
                    <td>
                      <%= link_to "Job ##{interpreter_invoice.job.id}", interpreter_invoice.job %>
                    <td>
                      <%= interpreter_invoice.start.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <%= interpreter_invoice.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <td>
                      <% @manager_invoice = interpreter_invoice.manager_invoices.first %>
                      <% if @manager_invoice %>
                        <% if current_user.manager? %>
                          <%= link_to "Manager Invoice ##{@manager_invoice.id}", @manager_invoice %>
                        <% else %>
                          <%= link_to "TSHA Invoice ##{@manager_invoice.id}", @manager_invoice %>
                        <% end %>
                      <% else %>
                        <span class="label label-warning">Waiting on Manager Invoice</span>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
          <% end %>
          <h3 class="page-header">
            Manager Invoices
          </h3>
          <!-- /.page-header -->
          <% if @manager_invoices.count == 0 %>
            <div class="alert alert-info" role="alert">No results found.</div>
          <% else %>
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>
                    ID
                  </th>
                  <th>
                    Job
                  </th>
                  <% if user_logged_in? %>
                    <th>
                      Interpreter Invoice
                    </th>
                  <% end %>
                  <th>
                    Interpreter
                  </th>
                  <th>
                    Job End
                  </th>
                  <% if user_logged_in? %>
                    <th>
                      Approved by Customer?
                    </th>
                  <% elsif customer_logged_in? %>
                    <th>
                      Action
                    </th>
                  <% end %>
                </tr>
              </thead>
              <tbody>
                <% @manager_invoices.each do |manager_invoice| %>
                  <tr>
                    <td>
                      <%= link_to "Invoice ##{manager_invoice.id}", manager_invoice %>
                    </td>
                    <td>
                      <%= link_to "Job ##{manager_invoice.job.id}", manager_invoice.job %>
                    </td>
                    <% if user_logged_in? %>
                      <td>
                        <%= link_to "Invoice ##{manager_invoice.interpreter_invoice.id}", manager_invoice.  interpreter_invoice %>
                      </td>
                    <% end %>
                    <td>
                      <% if user_logged_in? %>
                        <%= link_to "#{manager_invoice.user.first_name} #{manager_invoice.user.last_name}", manager_invoice  .user %>
                      <% else %>
                        <%= manager_invoice.user.first_name %> <%= manager_invoice.user.last_name %>
                      <% end %>
                    </td>
                    <td>
                      <%= manager_invoice.end.strftime("%A, %d %b %Y %l:%M %p") %>
                    </td>
                    <% if user_logged_in? %>
                      <td>
                        <% if manager_invoice.customer_approved? %>
                          <span class="label label-success">Approved by Customer</span>
                        <% else %>
                          <span class="label label-warning">Waiting for Customer Approval</span>
                        <% end %>
                      </td>
                    <% elsif customer_logged_in? %>
                      <td>
                        <% if manager_invoice.customer_approved? %>
                          
                        <% else %>
                          <span class="label label-success">Approved by You</span>
                        <% end %>
                      </td>
                    <% end %>
                 </tr>
                <% end %>
              </tbody>
            </table>
            <!-- /.table table-striped table-hover -->
            <% end %>
        <% end %>
    	</section>
    	<!-- /.user_info -->
  	</aside>
  	<!-- /.col-lg-12 -->
	</div>
	<!-- /.row -->
</div>
<!-- /.page-wrapper -->