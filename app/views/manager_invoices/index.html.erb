<% if user_logged_in? && current_user.manager? %>
  <% provide(:title, 'All Manager Invoices') %>
  <%= render 'layouts/manager_dashboard' %>
<% elsif user_logged_in? %>
  <% provide(:title, 'TSHA Invoices') %>
  <%= render 'layouts/interpreter_dashboard' %>
<% elsif customer_logged_in? %>
  <% provide(:title, 'TSHA Invoices') %>
  <%= render 'layouts/customer_dashboard' %>
<% end %>
<div id="page-wrapper">
  <%= render 'layouts/alerts' %>
  <div class="row">
    <div class="col-lg-12">
      <h1 class="page-header">
        <% if user_logged_in? && current_user.manager? %>
          All Manager Invoices
        <% elsif user_logged_in? %>
          TSHA Invoices
        <% else %>
          Your Invoices
        <% end %>
      </h1>
      <!-- /.page-header -->
    </div>
    <!-- /.col-lg-12 -->
  </div>
  <!-- /.row -->
  <% if user_logged_in? && current_user.manager? %>
    <div class="panel panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">
          Search by: ID, Job Type, Address, Contact Name, or Contact Phone
        </h3>
        <!-- /.panel-title -->
      </div>
      <!-- /.panel-heading -->
      <div class="panel-body">
        <%= form_tag(manager_invoices_path, :method => "get", class: "navbar-form", id: "search-form") do %>
          <div class="input-append">
            <%= text_field_tag :search, params[:search], class: "span2", placeholder: "Search" %>
              <!-- In order to have the "search" icon int the button, we need to use plain HTML instead 
             of using a Rails form helper -->
            <button type="submit" class="btn btn-primary">
              Search
            </button>
              <!-- /.btn btn-primary -->
          </div>
            <!-- /.input-append -->
        <% end %>
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel panel-info -->
  <% end %>

  <% if user_logged_in? %>
    <%= will_paginate @manager_invoices %>
  <% end %>

  <% if @manager_invoices.count == 0 %>
    <div class="alert alert-info" role="alert">No results found.</div>
  <% end %>
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>
          ID
        </th>
        <th>
          Job
        </th>
        <% if user_logged_in? %>
          <th>
            Interpreter Invoice
          </th>
        <% end %>
        <th>
          Interpreter
        </th>
        <th>
          Job End
        </th>
        <% if user_logged_in? %>
          <th>
            Approved by Customer?
          </th>
        <% elsif customer_logged_in? %>
          <th>
            Action
          </th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @manager_invoices.each do |manager_invoice| %>
        <tr>
          <td>
            <%= link_to "Invoice ##{manager_invoice.id}", manager_invoice %>
          </td>
          <td>
            <%= link_to "Job ##{manager_invoice.job.id}", manager_invoice.job %>
          </td>
          <% if user_logged_in? %>
            <td>
              <%= link_to "Invoice ##{manager_invoice.interpreter_invoice.id}", manager_invoice.interpreter_invoice %>
            </td>
          <% end %>
          <td>
            <% if user_logged_in? %>
              <%= link_to "#{manager_invoice.user.first_name} #{manager_invoice.user.last_name}", manager_invoice.user %>
            <% else %>
              <%= manager_invoice.user.first_name %> <%= manager_invoice.user.last_name %>
            <% end %>
          </td>
          <td>
            <%= manager_invoice.end.strftime("%A, %d %b %Y %l:%M %p") %>
          </td>
          <% if user_logged_in? %>
            <td>
              <% if manager_invoice.customer_approved? %>
                <span class="label label-success">Approved by Customer</span>
              <% else %>
                <span class="label label-warning">Waiting for Customer Approval</span>
              <% end %>
            </td>
          <% elsif customer_logged_in? %>
            <td>
              <% if manager_invoice.customer_approved? %>
                
              <% else %>
                <span class="label label-success">Approved by You</span>
              <% end %>
            </td>
          <% end %>
       </tr>
      <% end %>
    </tbody>
  </table>
  <!-- /.table table-striped table-hover -->

  <% if user_logged_in? %>
    <%= will_paginate @manager_invoices %>
  <% end %>
</div>
<!-- /.page-wrapper -->
